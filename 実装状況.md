# 実装状況

## 実装された機能

### ✅ 1. 認証・ユーザー管理機能

- 会員登録/ログイン（メールアドレス・パスワード認証）

### ✅ 2. 案件管理・SFA機能（Deal Management）

#### A. 案件データ構造

- 基本情報（案件名、エンド顧客情報：社名、担当者、連絡先）
- 紐付け（担当Vendor ID、担当Partner ID）
- 契約条件（報酬タイプ：定率% or 定額￥、報酬額/率）
- 金額（見込金額、確定契約金額：税抜/税込）

#### B. ステータスワークフロー

- 新規リード (New Lead)
- 商談中 (Negotiation)
- 契約締結/受注 (Contracted) ※金額と報酬条件をロック
- 入金完了 (Paid)
- 分配完了 (Distributed)
- 失注 (Lost)

#### C. コミュニケーション機能

- 案件ごとのチャットスレッド機能（Vendor ⇔ Partner）

### ✅ 3. 管理画面・ダッシュボード

#### Partner画面

- ホーム（今月の報酬額、進行中案件数）
- 案件一覧（カンバン形式またはリスト形式での進捗表示）

#### Vendor画面

- リード管理（全Partnerからの紹介案件一覧）

### ✅ 4. Partner（紹介者）のフロー

- Dashboard（今月の報酬総額、進行中案件サマリを表示）
- 案件登録 (New Deal)
- 案件詳細 (Deal Detail)
  - タイムライン表示（商談中→契約...）
  - Vendorへのチャット・コメント投稿

### ✅ 5. Vendor（掲載企業）のフロー

- 案件管理ボード (Kanban)（Trelloのようなカンバン形式、ドラッグ&ドロップでステータス移動）
- 請求書作成 (Billing)

---

## 未実装機能

### ❌ 1. マネーフロー（収納代行モデル）

- 請求（案件ごとのバーチャル口座発行）
- 入金（Clientからバーチャル口座へ入金）
- 着金（Admin管理の銀行口座への着金）
- 分配（自動計算と即時振込実行）

### ❌ 2. 利用外部API

- GMOあおぞらネット銀行 API
  - バーチャル口座発行
  - 入金通知Webhook
  - 振込依頼（他行/自行宛て）

### ❌ 3. 認証・ユーザー管理機能

- 企業情報管理（法人名、適格請求書発行事業者番号：インボイス制度対応）
- 口座情報登録（売上・報酬を受け取るための銀行口座情報、口座名義カナのバリデーションチェック）

### ❌ 4. 案件管理・SFA機能（Deal Management）

#### C. コミュニケーション機能

- ステータス変更時のメール/LINE通知

### ❌ 5. 決済・自動分配機能（Billing & Payout）

#### A. バーチャル口座発行ロジック

- トリガー：案件ステータスが「契約締結」に変更された時
- 処理：銀行APIを叩き、振込入金口座（支店・口座番号）を取得し、案件DBに保存
- 出力：請求書PDFに上記口座番号を自動印字

#### B. 入金消込・分配計算ロジック

- トリガー：銀行からの入金通知Webhook受信時
- 照合：Webhook内の「入金口座番号」と「入金額」をDBと照合
- 過不足判定（一致/不足/超過）
- 計算式
  - Partner報酬 = (売上税抜 × 報酬率) + 消費税
  - Vendor受取額 = (入金総額) - (Partner報酬) - (Platform利用料)

#### C. 即時振込実行ロジック

- トリガー：計算完了後、即時（ジョブキュー処理）
- 手数料処理（振込手数料は受取人負担、実際の送金額 = 計算上の報酬額 - 振込手数料）
- 最低支払額判定（未払報酬プール機能）

### ❌ 6. 管理画面・ダッシュボード

#### Partner画面

- ウォレット（振込履歴、支払通知書PDFダウンロード）

#### Vendor画面

- 請求管理（請求書発行、支払い通知書発行、入金ステータス確認）
- アライアンス設定（報酬率のデフォルト設定、Partner承認/拒否）

#### Admin画面

- 取引ログ（全ての入出金履歴、APIエラーログ）
- 手動消込（自動消込失敗時の強制ステータス変更機能）
- マスタ設定（振込手数料設定、消費税率設定）

### ❌ 7. Partner（紹介者）のフロー

- Dashboard（紹介先企業名、担当者名を入力、紹介リンク発行：URLコピー）
- ウォレット (Wallet)（入出金履歴：通帳のようなUI、支払通知書：インボイス対応PDFのダウンロード）

### ❌ 8. Vendor（掲載企業）のフロー

- 請求書作成 (Billing)（「発行」ボタンで自動的に「振込先：GMOあおぞらネット銀行 [専用支店] [専用番号]」が印字されたPDFを生成）
- パートナー承認 (Partner Settings)（提携申請の承認/拒否、個別報酬レートの設定）

### ❌ 9. 非機能要件

- 24時間稼働（サーバーは24時間稼働・監視）
- 冪等性の担保（Transaction IDによる排他制御）
- 通信暗号化（全てSSL/TLS通信）
- APIキー管理（AWS Secrets Manager等のセキュアなストレージで管理）
- 操作ログ（金銭に関わる操作の全ログ保存）
- 処理速度（入金Webhook受信から振込指示完了まで1分以内）
