# 案件登録画面設計書

## 1. 画面概要

### 1.1. 目的
Partner（紹介パートナー）が新規案件を登録するための画面。登録された案件は「Lead（リード）」ステータスで開始され、Vendor（掲載企業）が対応を開始するまで待機状態となる。

### 1.2. アクセス権限
- **操作可能**: Partner（ログイン中のユーザー）
- **閲覧不可**: Vendor、Admin（案件一覧からは閲覧可能）

### 1.3. 画面遷移
- **遷移元**: Partnerダッシュボード > 「新規案件登録」ボタン
- **遷移先**: 
  - 登録成功時: 案件詳細画面（登録した案件の詳細）
  - キャンセル時: Partnerダッシュボード

---

## 2. 入力項目詳細

### 2.1. 必須項目

| 項目名 | フィールド名 | 型 | 最大文字数 | 説明 |
|--------|-------------|-----|-----------|------|
| 案件名 | `dealName` | String | 100 | 案件を識別するための名称。例：「○○株式会社様 システム導入案件」 |
| 会社名 | `clientCompanyName` | String | 100 | エンド顧客（Client）の会社名 |
| 担当者名 | `clientContactName` | String | 50 | エンド顧客の担当者名（姓名） |

### 2.2. 任意項目

| 項目名 | フィールド名 | 型 | 最大文字数 | 説明 |
|--------|-------------|-----|-----------|------|
| 担当者メールアドレス | `clientEmail` | String(Email) | 255 | エンド顧客の担当者メールアドレス |
| 担当者電話番号 | `clientPhone` | String | 20 | エンド顧客の担当者電話番号（ハイフン含む可） |
| 備考・メモ | `notes` | Text | 1000 | PartnerがVendorに伝えたい補足情報 |

### 2.3. システム設定項目（非表示）

| 項目名 | フィールド名 | 値 | 説明 |
|--------|-------------|-----|------|
| ステータス | `status` | `Lead` | 登録時は必ず「Lead」で開始 |
| 担当Partner ID | `partnerId` | ログインユーザーID | 自動設定 |
| 担当Vendor ID | `vendorId` | `null` または 選択値 | ※要確認（後述） |
| 作成日時 | `createdAt` | 現在日時 | 自動設定 |

---

## 3. バリデーションルール

### 3.1. 必須チェック
- 案件名、会社名、担当者名は必須入力

### 3.2. 形式チェック
- **メールアドレス**: RFC 5322準拠の形式チェック（任意項目だが、入力された場合は検証）
- **電話番号**: 数字、ハイフン、括弧のみ許可（任意項目）

### 3.3. 文字数チェック
- 各項目の最大文字数を超えた場合はエラー表示

### 3.4. エラー表示
- エラーがある項目の下に赤色でエラーメッセージを表示
- 例：「案件名を入力してください」「メールアドレスの形式が正しくありません」

---

## 4. 操作フロー

### 4.1. 登録処理フロー

```
1. Partnerがフォームに入力
   ↓
2. 「登録する」ボタンクリック
   ↓
3. クライアント側バリデーション実行
   ↓
4. エラーがあれば表示して処理中断
   ↓
5. サーバーへPOSTリクエスト送信
   ↓
6. サーバー側バリデーション実行
   ↓
7. DBに案件レコード作成（status='Lead'）
   ↓
8. 成功レスポンス返却
   ↓
9. 案件詳細画面へ遷移
```

### 4.2. 紹介リンク発行機能（要検討）

- 紹介リンク発行機能については、詳細仕様が未確定のため、実装は保留とする
- 将来的な機能拡張として検討する項目

---

## 5. エラーハンドリング

エラーハンドリングの仕様については、[共通仕様_エラーハンドリング.md](./共通仕様_エラーハンドリング.md)を参照してください。

---

## 6. UI/UX要件

### 6.1. フォームデザイン
- モダンなカード型レイアウト
- 入力フィールドは適切なラベルとプレースホルダーを表示
- 必須項目には「*」マークを表示

### 6.2. ボタン配置
- **キャンセル**: 左側、セカンダリカラー（グレー系）
- **登録する**: 右側、プライマリカラー（ブランドカラー）
- 登録処理中は「登録中...」と表示し、ボタンを無効化

### 6.3. 成功時のフィードバック
- 登録成功時は、案件詳細画面へ遷移する前に、トースト通知で「案件を登録しました」と表示

---

## 7. 確認事項・不明点

以下の点について、要件定義書から明確でないため、確認が必要です。

### 7.1. Vendor選択について
- **質問**: Partnerが案件登録時に、担当Vendorを選択する必要がありますか？
  - **案1**: Partnerが複数のVendorと提携している場合、ドロップダウンで選択
  - **案2**: システムが自動で割り当て（デフォルトVendor設定など）
  - **案3**: 登録時は未設定で、後でAdminまたはVendorが割り当て

### 7.2. 案件名の入力方法
- **質問**: 「案件名」はPartnerが自由に入力する形式で良いですか？
  - 要件定義書には「案件名」と「紹介先企業名」の両方が記載されていますが、同じものとして扱いますか？

### 7.3. 紹介リンク発行の詳細
- **質問**: 紹介リンク発行機能の詳細仕様について
  - 紹介リンクは何のために使いますか？
  - 誰がそのリンクを使いますか？
  - リンクを使う人にログインは必要ですか？
  - リンクに有効期限はありますか？
  - 1つのリンクで何件まで案件を登録できますか？
  - リンクは無効化できますか？
  - 紹介リンク経由で登録された案件と、通常の案件登録の違いは何ですか？
  - リンク経由の場合、どの情報が自動入力されますか？
  - リンク経由で登録された案件のステータスは「Lead」で開始されますか？
  - リンクをクリックした人が入力できる情報は何ですか？
  - Partnerが既に入力した情報（会社名、担当者名など）は表示されますか？
  - Clientが追加で入力できる情報はありますか？
  - 紹介リンクを発行する際、特定のVendorを指定する必要がありますか？
  - それとも、後でVendorが割り当てられますか？

### 7.4. 報酬条件について
- **確認**: 案件登録時点では報酬タイプ（定率%/定額￥）や報酬率は入力しない認識で正しいですか？
  - ワークフローによると、Leadステータスでは金額入力不可とあるため、報酬条件も後でVendorが設定する想定です。

### 7.5. 見込金額について
- **質問**: 案件登録時に「見込金額」を入力する必要はありますか？
  - 要件定義書のデータ構造には「見込金額」が含まれていますが、Leadステータスでは金額入力不可と矛盾します。

---

## 8. 実装時の注意点

1. **ステータス管理**: 登録時は必ず`status='Lead'`で保存すること
2. **権限チェック**: Partner以外のユーザーがアクセスした場合は403エラーを返す
3. **ログ記録**: 案件登録操作は操作ログに記録すること（将来の監査対応）

---

## 9. 関連画面・機能

- **案件詳細画面**: 登録成功後の遷移先
- **案件一覧画面**: 登録した案件が一覧に表示される
- **Partnerダッシュボード**: 登録案件数がカウントされる

